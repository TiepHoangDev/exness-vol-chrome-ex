chrome.runtime.onMessage.addListener((t,n,o)=>{if(t.action==="fetchData")return s(t.url,"GET",t.token).then(r=>o({success:!0,data:r})).catch(r=>o({success:!1,error:r.toString()})),!0;if(t.action==="sendRequest")return s(t.url,t.method,t.token,t.body,t.extraHeaders).then(r=>o({success:!0,data:r})).catch(r=>o({success:!1,error:r.toString()})),!0});async function s(t,n="GET",o,r=null,i={}){try{const e={Accept:"application/json, text/plain, */*",Authorization:"Bearer "+o,"Content-Type":"application/json",...i},c={method:n,headers:e};r&&(c.body=JSON.stringify(r));const a=await fetch(t,c);if(!a.ok){const u=await a.text();throw new Error(`HTTP ${a.status}: ${u||a.statusText}`)}return a.status===204?{}:await a.json()}catch(e){throw console.error("Background request error:",e),e}}
